---
import qs from "qs";
import { stripeApi } from "../../utils/stripeApi";
import Layout from "../../layouts/Layout.astro";
import Alert from "../../components/alert.astro";

const token = Astro.cookies.get("token");
const user = Astro.cookies.get("user");

let err: string | null = null;
let data: any = null;

if (!token?.value || !user?.value) {
  return Astro.redirect("/auth/login");
}

const query = qs.stringify({
  filters: {
    title: {
      $eq: "hello",
    },
  },
  populate: {
    cart_item: {
      fields: ["firstName", "lastName"],
      populate: {
        product: {
          fields: ["title", "price"],
        },
      },
    },
  },
});

try {
  const res = await stripeApi.get("/api/carts" + "?" + query, {
    headers: {
      Authorization: `Bearer ${token.value}`,
    },
  });
  console.log(res.data);
  data = res.data;
} catch (error: any) {
  console.log(error);

  err = error?.message;
}
---

<Layout title="Cart">
  <main class="container mx-auto p-5">
    {err && <Alert title={err} type="error" />}
    <h1 class="text-2xl font-bold">Cart</h1>
    <br />
    <div class="grid grid-cols-4 gap-4">cart</div>
  </main>
</Layout>
